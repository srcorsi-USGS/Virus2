<<<<<<< HEAD
rain.site
rain.site[i]
i
i <- 6
rain.site[i]
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],,format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],format(Sys.time(), "%b%d%Y_%H%M")
paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
filenm
write.table(dfsamples5,filenm,sep="\t",row.names=F)
df <- dfsamples5
bwplot((df$Human_virus+0.01)~df$Sample.Type,data=df,
xlab="Month",ylab="Pathogens (gc/L)",
main="Event type by site: Sum of human viruses",
scales = list(y = list(log=10)))
library("lattice")
library("latticeExtra")
bwplot((df$Human_virus+0.01)~df$Sample.Type,data=df,
xlab="Month",ylab="Pathogens (gc/L)",
main="Event type by site: Sum of human viruses",
scales = list(y = list(log=10)))
bwplot((df$Human_virus+0.01)|df$Sample.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
bwplot((df$Human_virus+0.01)~df$Sample.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
df <- dfsamples5
bwplot((df$Human_virus+0.01),data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
df <- dfsamples5
bwplot((df$Human_virus+0.01),data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
View(dfsamples5)
bwplot((df$Human_virus+0.01)~df$Site.Name|df$Sample.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
df <- subset(dfsamples5,!is.na(Human_virus))
bwplot((df$Human_virus+0.01)~df$Site.Name|df$Sample.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
bwplot((df$Human_virus+0.01)~df$Site.Name|df$Sample.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses")
(df$Human_virus+0.01)
df$Site.Name
df$Sample.Type
bwplot((df$Human_virus+0.01)~df$Site.Name|df$Sample.Type.x,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses"),
scales = list(y = list(log=10)))
bwplot((df$Human_virus+0.01)~df$Site.Name|df$Sample.Type.x,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
dfsample5$Human_virus
dfsamples5$Human_virus
dfsamples5$Human_virus*dfsamples5$event.vol
cf2liters <- 28.316846592
dfsample5$Load_Human_virus <- dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
dfsamples5$Load_Human_virus <- dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
write.table(dfsamples5,filenm,sep="\t",row.names=F)
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
filenm
df$Load_Human_virus
df <- subset(dfsamples5,!is.na(Human_virus))
bwplot((df$Load_Human_virus+0.01)~df$Site.Name|df$Sample.Type.x,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
bwplot((df$Load_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
dfsamples5$Daily_Human_virus <- dfsamples5$Load_Human_virus/dfsamples5$duration*24
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
write.table(dfsamples5,filenm,sep="\t",row.names=F)
filenm
write.table(dfsamples5,filenm,sep="\t",row.names=F)
write.table(dfsamples5,filenm,sep="\t",row.names=F)
df <- subset(dfsamples5,!is.na(Human_virus))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
i <- 5
save.image("D:/srcldata/R/MMSD_virus/Virus2/16th/16thDataCompilation.RData")
i
dir.Q <- paste(Project,"/MMSD/Viruses/Menomonee Viruses/Data compilation/UnitValues/mmsd/",sep="")
Sitefile <- paste(rain.site[i],"_Final.txt",sep="")
Qfile <- paste(rain.site[i],".rdb",sep="")
dfRain <- read.delim(paste(dir.prec,Sitefile,sep=""))
dfQ <- read.delim(paste(dir.Q,Qfile,sep=""))
dfQ <- subset(dfQ,substr(dfQ$NAME,1,1)=="Q" & Q != -1.23456e+25)
hr <- trunc(dfQ$MINUTE/60)
min <- dfQ$MINUTE-hr*60
GMToffset <- 5 # hours to central standard time
dfQ$pdate <- strptime(paste(dfQ$YEAR,"-",dfQ$MONTH,"-",dfQ$DAY," ",hr,":",min,sep=""),format="%Y-%m-%d %H:%M")
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="") - GMToffset*60*60
#  dfRain$pdate2 <- as.POSIXlt(dfRain$pdate,isdst=1)
dfRain <- dfRain[which(!is.na(dfRain$pdate)),]
dfsamples.all <- read.delim(paste(Rlocal,"/MMSD_virus/Virus2/virus2Prelim5.txt",sep=""))
dfsamples <- subset(dfsamples.all,Site.Name==site[i])
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep="")
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
for (i in 1:nrow(dfsamples2)){
if(dfsamples2$Sample.Type.x[i]=="Baseflow"){
dfsamples2$start_date[i] <- as.character(dfsamples2[i,"SSdate"])
dfsamples2$end_date[i] <- as.character(dfsamples2[i,"SEdate"])
}
}
dfsamples2$pdate <- strptime(dfsamples2$SSdate, format="%m/%d/%Y %H:%M")
dfsamples2$ddate <- as.Date(dfsamples2$pdate)
dfsamples2$Hbpdate <- strptime(dfsamples2$start_date, format="%m/%d/%Y %H:%M")
dfsamples2$Hepdate <- strptime(dfsamples2$end_date, format="%m/%d/%Y %H:%M")
View(dfsamples2)
dfsamples3 <- Hydrovol(dfQ=dfQ,Q="VALUE",time="pdate",df.dates=dfsamples2,bdate="Hbpdate",edate="Hepdate")
View(dfsamples3)
dfsamples4 <- RMeventsSamples(df=dfRain,ieHr=12,rain="rain",time="pdate",dfsamples=dfsamples3,bdate="Hbpdate",edate="Hepdate")
dfsamples5 <- WQcompos(df.samples=dfsamples4,sampleID="USGS_ID",parms="Human_virus",volume="event.vol")
cf2liters <- 28.316846592
dfsamples5$Load_Human_virus <- dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
dfsamples5$Daily_Human_virus <- dfsamples5$Load_Human_virus/dfsamples5$duration*24
# write file with date in name
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
filenm
rain.site[i]
i
rain.site[i]
i <-5
rain.site[i]
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
filenm
write.table(dfsamples5,filenm,sep="\t",row.names=F)
df <- subset(dfsamples5,!is.na(Human_virus))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
bwplot((df$Load_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
bwplot((df$Load_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human virus load",
scales = list(y = list(log=10)))
bwplot((df$Load_Human_virus+0.01)~df$Site.Name|df$Sample.Type.x,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human virus load",
scales = list(y = list(log=10)))
bwplot((df$Human_virus+0.01)~df$Site.Name|df$Sample.Type.x,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
bwplot((df$Human_virus+0.01)~df$Site.Name|df$Sample.Type.x,data=df,
xlab="",ylab="Pathogen concentrations (gc/L)",
main="Event type: Sum of human viruses",
scales = list(y = list(log=10)))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
i <- 4
dir.Q <- paste(Project,"/MMSD/Viruses/Menomonee Viruses/Data compilation/UnitValues/mmsd/",sep="")
Sitefile <- paste(rain.site[i],"_Final.txt",sep="")
Qfile <- paste(rain.site[i],".rdb",sep="")
dfRain <- read.delim(paste(dir.prec,Sitefile,sep=""))
dfQ <- read.delim(paste(dir.Q,Qfile,sep=""))
dfQ <- subset(dfQ,substr(dfQ$NAME,1,1)=="Q" & Q != -1.23456e+25)
hr <- trunc(dfQ$MINUTE/60)
min <- dfQ$MINUTE-hr*60
GMToffset <- 5 # hours to central standard time
dfQ$pdate <- strptime(paste(dfQ$YEAR,"-",dfQ$MONTH,"-",dfQ$DAY," ",hr,":",min,sep=""),format="%Y-%m-%d %H:%M")
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="") - GMToffset*60*60
#  dfRain$pdate2 <- as.POSIXlt(dfRain$pdate,isdst=1)
dfRain <- dfRain[which(!is.na(dfRain$pdate)),]
dfsamples.all <- read.delim(paste(Rlocal,"/MMSD_virus/Virus2/virus2Prelim5.txt",sep=""))
dfsamples <- subset(dfsamples.all,Site.Name==site[i])
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep="")
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
for (j in 1:nrow(dfsamples2)){
if(dfsamples2$Sample.Type.x[j]=="Baseflow"){
dfsamples2$start_date[j] <- as.character(dfsamples2[j,"SSdate"])
dfsamples2$end_date[j] <- as.character(dfsamples2[j,"SEdate"])
}
}
dfsamples2$pdate <- strptime(dfsamples2$SSdate, format="%m/%d/%Y %H:%M")
dfsamples2$ddate <- as.Date(dfsamples2$pdate)
dfsamples2$Hbpdate <- strptime(dfsamples2$start_date, format="%m/%d/%Y %H:%M")
dfsamples2$Hepdate <- strptime(dfsamples2$end_date, format="%m/%d/%Y %H:%M")
View(dfsamples2)
dfsamples3 <- Hydrovol(dfQ=dfQ,Q="VALUE",time="pdate",df.dates=dfsamples2,bdate="Hbpdate",edate="Hepdate")
View(dfsamples3)
dfsamples4 <- RMeventsSamples(df=dfRain,ieHr=12,rain="rain",time="pdate",dfsamples=dfsamples3,bdate="Hbpdate",edate="Hepdate")
dfsamples5 <- WQcompos(df.samples=dfsamples4,sampleID="USGS_ID",parms="Human_virus",volume="event.vol")
cf2liters <- 28.316846592
dfsamples5$Load_Human_virus <- dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
dfsamples5$Daily_Human_virus <- dfsamples5$Load_Human_virus/dfsamples5$duration*24
# write file with date in name
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
filenm
write.table(dfsamples5,filenm,sep="\t",row.names=F)
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
df <- subset(dfsamples5,!is.na(Human_virus))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
i <- 1
rain.site <- rain.site[1:3]
for (i in 1:length(rain.site)){
rain.site
for (i in 1:length(rain.site)){
dir.Q <- paste(Project,"/MMSD/Viruses/Menomonee Viruses/Data compilation/UnitValues/mmsd/",sep="")
Sitefile <- paste(rain.site[i],"_Final.txt",sep="")
Qfile <- paste(rain.site[i],".rdb",sep="")
dfRain <- read.delim(paste(dir.prec,Sitefile,sep=""))
dfQ <- read.delim(paste(dir.Q,Qfile,sep=""))
dfQ <- subset(dfQ,substr(dfQ$NAME,1,1)=="Q" & Q != -1.23456e+25)
hr <- trunc(dfQ$MINUTE/60)
min <- dfQ$MINUTE-hr*60
GMToffset <- 5 # hours to central standard time
dfQ$pdate <- strptime(paste(dfQ$YEAR,"-",dfQ$MONTH,"-",dfQ$DAY," ",hr,":",min,sep=""),format="%Y-%m-%d %H:%M")
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="") - GMToffset*60*60
#  dfRain$pdate2 <- as.POSIXlt(dfRain$pdate,isdst=1)
dfRain <- dfRain[which(!is.na(dfRain$pdate)),]
dfsamples.all <- read.delim(paste(Rlocal,"/MMSD_virus/Virus2/virus2Prelim5.txt",sep=""))
dfsamples <- subset(dfsamples.all,Site.Name==site[i])
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
for (j in 1:nrow(dfsamples2)){
if(dfsamples2$Sample.Type.x[j]=="Baseflow"){
dfsamples2$start_date[j] <- as.character(dfsamples2[j,"SSdate"])
dfsamples2$end_date[j] <- as.character(dfsamples2[j,"SEdate"])
}
}
dfsamples2$pdate <- strptime(dfsamples2$SSdate, format="%m/%d/%Y %H:%M")
dfsamples2$ddate <- as.Date(dfsamples2$pdate)
dfsamples2$Hbpdate <- strptime(dfsamples2$start_date, format="%m/%d/%Y %H:%M")
dfsamples2$Hepdate <- strptime(dfsamples2$end_date, format="%m/%d/%Y %H:%M")
#Run scripts: 1. Hydrovol, 2. RMeventsSamples, 3. WQcompos
dfsamples3 <- Hydrovol(dfQ=dfQ,Q="VALUE",time="pdate",df.dates=dfsamples2,bdate="Hbpdate",edate="Hepdate")
dfsamples4 <- RMeventsSamples(df=dfRain,ieHr=12,rain="rain",time="pdate",dfsamples=dfsamples3,bdate="Hbpdate",edate="Hepdate")
dfsamples5 <- WQcompos(df.samples=dfsamples4,sampleID="USGS_ID",parms="Human_virus",volume="event.vol")
cf2liters <- 28.316846592
dfsamples5$Load_Human_virus <- dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
dfsamples5$Daily_Human_virus <- dfsamples5$Load_Human_virus/dfsamples5$duration*24
# write file with date in name
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
write.table(dfsamples5,filenm,sep="\t",row.names=F)
}
i
for (i in 1:length(rain.site)){
dir.Q <- paste(Project,"/MMSD/Viruses/Menomonee Viruses/Data compilation/UnitValues/mmsd/",sep="")
Sitefile <- paste(rain.site[i],"_Final.txt",sep="")
Qfile <- paste(rain.site[i],".rdb",sep="")
dfRain <- read.delim(paste(dir.prec,Sitefile,sep=""))
dfQ <- read.delim(paste(dir.Q,Qfile,sep=""))
dfQ <- subset(dfQ,substr(dfQ$NAME,1,1)=="Q" & Q != -1.23456e+25)
hr <- trunc(dfQ$MINUTE/60)
min <- dfQ$MINUTE-hr*60
GMToffset <- 5 # hours to central standard time
dfQ$pdate <- strptime(paste(dfQ$YEAR,"-",dfQ$MONTH,"-",dfQ$DAY," ",hr,":",min,sep=""),format="%Y-%m-%d %H:%M")
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="") - GMToffset*60*60
#  dfRain$pdate2 <- as.POSIXlt(dfRain$pdate,isdst=1)
dfRain <- dfRain[which(!is.na(dfRain$pdate)),]
dfsamples.all <- read.delim(paste(Rlocal,"/MMSD_virus/Virus2/virus2Prelim5.txt",sep=""))
dfsamples <- subset(dfsamples.all,Site.Name==site[i])
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
for (j in 1:nrow(dfsamples2)){
if(dfsamples2$Sample.Type.x[j]=="Baseflow"){
dfsamples2$start_date[j] <- as.character(dfsamples2[j,"SSdate"])
dfsamples2$end_date[j] <- as.character(dfsamples2[j,"SEdate"])
}
}
dfsamples2$pdate <- strptime(dfsamples2$SSdate, format="%m/%d/%Y %H:%M")
dfsamples2$ddate <- as.Date(dfsamples2$pdate)
dfsamples2$Hbpdate <- strptime(dfsamples2$start_date, format="%m/%d/%Y %H:%M")
dfsamples2$Hepdate <- strptime(dfsamples2$end_date, format="%m/%d/%Y %H:%M")
#Run scripts: 1. Hydrovol, 2. RMeventsSamples, 3. WQcompos
dfsamples3 <- Hydrovol(dfQ=dfQ,Q="VALUE",time="pdate",df.dates=dfsamples2,bdate="Hbpdate",edate="Hepdate")
dfsamples4 <- RMeventsSamples(df=dfRain,ieHr=12,rain="rain",time="pdate",dfsamples=dfsamples3,bdate="Hbpdate",edate="Hepdate")
dfsamples5 <- WQcompos(df.samples=dfsamples4,sampleID="USGS_ID",parms="Human_virus",volume="event.vol")
cf2liters <- 28.316846592
dfsamples5$Load_Human_virus <- dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
dfsamples5$Daily_Human_virus <- dfsamples5$Load_Human_virus/dfsamples5$duration*24
# write file with date in name
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
write.table(dfsamples5,filenm,sep="\t",row.names=F)
}
i
View(dfsamples5)
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
df <- subset(dfsamples5,!is.na(Human_virus))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
dir.Q <- paste(Project,"/MMSD/Viruses/Menomonee Viruses/Data compilation/UnitValues/mmsd/",sep="")
Sitefile <- paste(rain.site[i],"_Final.txt",sep="")
Qfile <- paste(rain.site[i],".rdb",sep="")
dfRain <- read.delim(paste(dir.prec,Sitefile,sep=""))
dfQ <- read.delim(paste(dir.Q,Qfile,sep=""))
dfQ <- subset(dfQ,substr(dfQ$NAME,1,1)=="Q" & Q != -1.23456e+25)
dir.Q
Qfile
dfQ <- read.delim(paste(dir.Q,Qfile,sep=""))
dfQ <- read.delim(paste(dir.Q,Qfile,sep=""))
dfQ <- subset(dfQ,substr(dfQ$NAME,1,1)=="Q" & Q != -1.23456e+25)
hr <- trunc(dfQ$MINUTE/60)
min <- dfQ$MINUTE-hr*60
GMToffset <- 5 # hours to central standard time
dfQ$pdate <- strptime(paste(dfQ$YEAR,"-",dfQ$MONTH,"-",dfQ$DAY," ",hr,":",min,sep=""),format="%Y-%m-%d %H:%M")
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="") - GMToffset*60*60
#  dfRain$pdate2 <- as.POSIXlt(dfRain$pdate,isdst=1)
dfRain <- dfRain[which(!is.na(dfRain$pdate)),]
dfsamples.all <- read.delim(paste(Rlocal,"/MMSD_virus/Virus2/virus2Prelim5.txt",sep=""))
dfsamples <- subset(dfsamples.all,Site.Name==site[i])
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
for (j in 1:nrow(dfsamples2)){
if(dfsamples2$Sample.Type.x[j]=="Baseflow"){
dfsamples2$start_date[j] <- as.character(dfsamples2[j,"SSdate"])
dfsamples2$end_date[j] <- as.character(dfsamples2[j,"SEdate"])
}
}
dfsamples2$pdate <- strptime(dfsamples2$SSdate, format="%m/%d/%Y %H:%M")
dfsamples2$ddate <- as.Date(dfsamples2$pdate)
dfsamples2$Hbpdate <- strptime(dfsamples2$start_date, format="%m/%d/%Y %H:%M")
dfsamples2$Hepdate <- strptime(dfsamples2$end_date, format="%m/%d/%Y %H:%M")
View(dfsamples2)
dfsamples3 <- Hydrovol(dfQ=dfQ,Q="VALUE",time="pdate",df.dates=dfsamples2,bdate="Hbpdate",edate="Hepdate")
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
for (j in 1:nrow(dfsamples2)){
if(dfsamples2$Sample.Type.x[j]=="Baseflow"){
dfsamples2$start_date[j] <- as.character(dfsamples2[j,"SSdate"])
dfsamples2$end_date[j] <- as.character(dfsamples2[j,"SEdate"])
}
}
dfsamples2$pdate <- strptime(dfsamples2$SSdate, format="%m/%d/%Y %H:%M")
dfsamples2$ddate <- as.Date(dfsamples2$pdate)
dfsamples2$Hbpdate <- strptime(dfsamples2$start_date, format="%m/%d/%Y %H:%M")
dfsamples2$Hepdate <- strptime(dfsamples2$end_date, format="%m/%d/%Y %H:%M")
View(dfsamples2)
dfsamples3 <- Hydrovol(dfQ=dfQ,Q="VALUE",time="pdate",df.dates=dfsamples2,bdate="Hbpdate",edate="Hepdate")
dfsamples4 <- RMeventsSamples(df=dfRain,ieHr=12,rain="rain",time="pdate",dfsamples=dfsamples3,bdate="Hbpdate",edate="Hepdate")
dfsamples5 <- WQcompos(df.samples=dfsamples4,sampleID="USGS_ID",parms="Human_virus",volume="event.vol")
cf2liters <- 28.316846592
dfsamples5$Load_Human_virus <- dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
dfsamples5$Daily_Human_virus <- dfsamples5$Load_Human_virus/dfsamples5$duration*24
# write file with date in name
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
write.table(dfsamples5,filenm,sep="\t",row.names=F)
df <- subset(dfsamples5,!is.na(Human_virus))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
bwplot((df$Load_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Sum of human virus load",
scales = list(y = list(log=10)))
i <- 3
dir.Q <- paste(Project,"/MMSD/Viruses/Menomonee Viruses/Data compilation/UnitValues/mmsd/",sep="")
Sitefile <- paste(rain.site[i],"_Final.txt",sep="")
Qfile <- paste(rain.site[i],".rdb",sep="")
dfRain <- read.delim(paste(dir.prec,Sitefile,sep=""))
dfQ <- read.delim(paste(dir.Q,Qfile,sep=""))
dfQ <- subset(dfQ,substr(dfQ$NAME,1,1)=="Q" & Q != -1.23456e+25)
hr <- trunc(dfQ$MINUTE/60)
min <- dfQ$MINUTE-hr*60
GMToffset <- 5 # hours to central standard time
dfQ$pdate <- strptime(paste(dfQ$YEAR,"-",dfQ$MONTH,"-",dfQ$DAY," ",hr,":",min,sep=""),format="%Y-%m-%d %H:%M")
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="") - GMToffset*60*60
#  dfRain$pdate2 <- as.POSIXlt(dfRain$pdate,isdst=1)
dfRain <- dfRain[which(!is.na(dfRain$pdate)),]
dfsamples.all <- read.delim(paste(Rlocal,"/MMSD_virus/Virus2/virus2Prelim5.txt",sep=""))
dfsamples <- subset(dfsamples.all,Site.Name==site[i])
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
dfhydro <- read.delim(paste(dir.Q,rain.site[i],"/",rain.site[i],"-storm-volume-2009-11_FINAL.txt",sep=""))
dfsamples2 <- merge(dfsamples,dfhydro,by.x="Study.Sample.ID",by.y="USGS.ID",all=T)
dfsamples2$start_date <- as.character(dfsamples2$start_date)
dfsamples2$end_date <- as.character(dfsamples2$end_date)
for (j in 1:nrow(dfsamples2)){
if(dfsamples2$Sample.Type.x[j]=="Baseflow"){
dfsamples2$start_date[j] <- as.character(dfsamples2[j,"SSdate"])
dfsamples2$end_date[j] <- as.character(dfsamples2[j,"SEdate"])
}
}
dfsamples2$pdate <- strptime(dfsamples2$SSdate, format="%m/%d/%Y %H:%M")
dfsamples2$ddate <- as.Date(dfsamples2$pdate)
dfsamples2$Hbpdate <- strptime(dfsamples2$start_date, format="%m/%d/%Y %H:%M")
dfsamples2$Hepdate <- strptime(dfsamples2$end_date, format="%m/%d/%Y %H:%M")
View(dfsamples2)
#Run scripts: 1. Hydrovol, 2. RMeventsSamples, 3. WQcompos
dfsamples3 <- Hydrovol(dfQ=dfQ,Q="VALUE",time="pdate",df.dates=dfsamples2,bdate="Hbpdate",edate="Hepdate")
dfsamples4 <- RMeventsSamples(df=dfRain,ieHr=12,rain="rain",time="pdate",dfsamples=dfsamples3,bdate="Hbpdate",edate="Hepdate")
dfsamples5 <- WQcompos(df.samples=dfsamples4,sampleID="USGS_ID",parms="Human_virus",volume="event.vol")
cf2liters <- 28.316846592
dfsamples5$Load_Human_virus <- dfsamples5$Human_virus*dfsamples5$event.vol*cf2liters
dfsamples5$Daily_Human_virus <- dfsamples5$Load_Human_virus/dfsamples5$duration*24
View(dfsamples5)
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
write.table(dfsamples5,filenm,sep="\t",row.names=F)
df <- subset(dfsamples5,!is.na(Human_virus))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
rain.site <- c("MenoFalls","LMDonges","Underwood","Honey","70th","16th")
site <- c("Meno Falls","Donges Bay","Underwood","Honey","70th St.","16th St.")
i
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_",format(Sys.time(), "%b%d%Y_%H%M"),".txt",sep="")
dfsite <- read.delim(filenm)
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i]),"Mar05.txt",sep="")
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"Mar05.txt",sep="")
dfsite <- read.delim(filenm)
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_Mar05.txt",sep="")
dfsite <- read.delim(filenm)
for (i in 1:length(site)){
filenm <- paste(Rlocal,"/MMSD_virus/Virus2/",rain.site[i],"/",rain.site[i],"_Mar05.txt",sep="")
dfsite <- read.delim(filenm)
if(i==1) df <- dfsite
if(i>1) df <- rbind(df,dfsite)
}
View(df)
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10)))
bwplot((df$Daily_Human_virus+0.01)~df$Site.Name|df$Event.Type,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10),x=list(rot=90)))
bwplot((df$Daily_Human_virus+0.01)~df$Event.Type|df$Site.Name,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10),x=list(rot=90)))
bwplot((df$Daily_Human_virus+0.01)~df$Sample.Type.x|df$Site.Name,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10),x=list(rot=90)))
bwplot((df$Load_Human_virus+0.01)~df$Sample.Type.x|df$Site.Name,data=df,
xlab="",ylab="Pathogen load (gc)",
main="Event type: Daily mean human virus load",
scales = list(y = list(log=10),x=list(rot=90)))
plot(df$depth,df$Human_virus)
plot(df$depth,(df$Human_virus+0.01))
plot(df$depth,(df$Human_virus+0.01),log="y")
?lm
lm((Human_virus+0.01)~depth+Qmax)
lm((Human_virus+0.01)~depth+Qmax,data=df)
m1 <- lm((Human_virus+0.01)~depth+Qmax,data=df)
summary(m1)
subdf <- subset(df,Event.Type != "Baseflow")
m2 <- lm((Human_virus+0.01)~depth+Qmax,data=subdf)
summary(m2)
subdf <- subset(subdf,Human_virus > 0)
m3 <- lm((Human_virus+0.01)~depth+Qmax,data=subdf)
summary(m3)
plot(subdf$depth,(subdf$Human_virus+0.01),log="y")
subdf <- subset(df,Event.Type != "Baseflow")
plot(subdf$depth,(subdf$Human_virus+0.01),log="y")
save.image("D:/srcldata/R/MMSD_virus/Virus2/Graphics/Loadings graphs.RData")
=======
axis.POSIXct(1,subdf[,date],at=rday,format=" ",tcl=-0.5)
axis.POSIXct(3,subdf[,date],at=rhour,format=" ",tcl=0.2)
axis.POSIXct(3,subdf[,date],at=rday,format=" ",tcl=0.5)
axis.POSIXct(1,subdf[,date],format = "%m/%d/%y")
#  abline(v=df.events[i,sdate])
#  abline(v=df.events[i,edate])
#  axis.POSIXct(3,subdf$date,format = "%m/%d/%y",
#               at=c(df.events[i,sdate],df.events[i,edate]),
#               tcl=2)
p.sdate <- as.POSIXlt(df.events[i,sdate] - plot.buffer*24*3600/2,tz="")
p.edate <- as.POSIXlt(df.events[i,edate] + plot.buffer*24*3600/2,tz="")
subdf <- subset(df, df[,date]>=p.sdate & df[,date]<=p.edate)
rmax <- max(subdf[,rain] + 0.3)
subrain <- subdf[,rain]
subdate <- as.POSIXct(subdf[,date])
#Set Margins for first plot
par(mar= c(0, 4, 4, 2) + 0.1)
plot(subrain~subdate,
#       data=subdf,
type="h",
xaxt="n",
ylab="precipitation (mm)",
xlab="",
col="blue",
lwd=1,
yaxs="i",
ylim=c(rmax,0),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
mtext(main.title,side=3,line=2,cex=1.5)
mtext(paste("Event depth =",
round(df.events[i,rain],2),"mm"),
side=3,line=0.5,col=colors()[84])
arrows(df.events[i,sdate],(rmax-0.15),
df.events[i,edate],(rmax-0.15),
length=0.07,angle=20,col=colors()[84],
code=3)
########################## Graph Q  ################################################
subdfQ <- subset(dfQ, dfQ[,Qdate]>=p.sdate & dfQ[,Qdate]<=p.edate)
Qmax <- max(subdfQ[,Q] *1.05)
if(Qmax < 0) Qmax <- Qmax*0.95
if(Qmax > 0) Qmax <- Qmax*1.05
Qmin <- min(c(subdfQ[,Q]))
if(Qmin < 0) Qmin <- Qmin*1.05
if(Qmin > 0) Qmin <- Qmin*0.95
subQ <- subdfQ[,Q]
subdateQ <- as.POSIXct(subdfQ[,date])
#Set Margins for second plot
par(mar= c(5, 4, 0, 2) + 0.1)
plot(subQ~subdateQ,
#       data=subdf,
type="l",
xaxt="n",
ylab="Flow (cfs)",
xlab="",
col="red",
lwd=1,
yaxs="i",
ylim=c(Qmin,Qmax),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
r <- as.POSIXct(trunc(range(subdf[,date]), "days"))
r[2] <- r[2]+24*3600
rhour <- seq(r[1], r[2], by=24*3600/4)
rday <- seq(r[1], r[2], by="days")
axis.POSIXct(1,subdf[,date],at=rhour,format=" ",tcl=-0.2)
axis.POSIXct(1,subdf[,date],at=rday,format=" ",tcl=-0.5)
axis.POSIXct(3,subdf[,date],at=rhour,format=" ",tcl=0.2)
axis.POSIXct(3,subdf[,date],at=rday,format=" ",tcl=0.5)
axis.POSIXct(1,subdf[,date],format = "%m/%d/%y")
#  abline(v=df.events[i,sdate])
#  abline(v=df.events[i,edate])
#  axis.POSIXct(3,subdf$date,format = "%m/%d/%y",
#               at=c(df.events[i,sdate],df.events[i,edate]),
#               tcl=2)
logy
source('D:/srcldata/R/Rainmaker/fxn_RMevents.plotQ.R')
logy <- "y"
# Define plot layout: panel 1 for Q and panel 2 for FIB
mylayout <- matrix(c(1,
1,
2,
2,
2),5,1,byrow=TRUE)
layout(mylayout)
p.sdate <- as.POSIXlt(df.events[i,sdate] - plot.buffer*24*3600/2,tz="")
p.edate <- as.POSIXlt(df.events[i,edate] + plot.buffer*24*3600/2,tz="")
subdf <- subset(df, df[,date]>=p.sdate & df[,date]<=p.edate)
rmax <- max(subdf[,rain] + 0.3)
subrain <- subdf[,rain]
subdate <- as.POSIXct(subdf[,date])
#Set Margins for first plot
par(mar= c(0, 4, 4, 2) + 0.1)
plot(subrain~subdate,
#       data=subdf,
type="h",
xaxt="n",
ylab="precipitation (mm)",
xlab="",
col="blue",
lwd=1,
yaxs="i",
ylim=c(rmax,0),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
mtext(main.title,side=3,line=2,cex=1.5)
mtext(paste("Event depth =",
round(df.events[i,rain],2),"mm"),
side=3,line=0.5,col=colors()[84])
arrows(df.events[i,sdate],(rmax-0.15),
df.events[i,edate],(rmax-0.15),
length=0.07,angle=20,col=colors()[84],
code=3)
########################## Graph Q  ################################################
subdfQ <- subset(dfQ, dfQ[,Qdate]>=p.sdate & dfQ[,Qdate]<=p.edate)
Qmax <- max(subdfQ[,Q] *1.05)
if(Qmax < 0) Qmax <- Qmax*0.95
if(Qmax > 0) Qmax <- Qmax*1.05
Qmin <- min(c(subdfQ[,Q]))
if(Qmin <= 0) Qmin <- Qmin*1.05; logy <- "n"
if(Qmin > 0) Qmin <- Qmin*0.95; logy <- logy
subQ <- subdfQ[,Q]
subdateQ <- as.POSIXct(subdfQ[,date])
#Set Margins for second plot
par(mar= c(5, 4, 0, 2) + 0.1)
plot(subQ~subdateQ,
#       data=subdf,
type="l",
xaxt="n",
ylab="Flow (cfs)",
xlab="",
col="red",
lwd=1,
yaxs="i",
ylim=c(Qmin,Qmax),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
r <- as.POSIXct(trunc(range(subdf[,date]), "days"))
r[2] <- r[2]+24*3600
rhour <- seq(r[1], r[2], by=24*3600/4)
rday <- seq(r[1], r[2], by="days")
axis.POSIXct(1,subdf[,date],at=rhour,format=" ",tcl=-0.2)
axis.POSIXct(1,subdf[,date],at=rday,format=" ",tcl=-0.5)
axis.POSIXct(3,subdf[,date],at=rhour,format=" ",tcl=0.2)
axis.POSIXct(3,subdf[,date],at=rday,format=" ",tcl=0.5)
axis.POSIXct(1,subdf[,date],format = "%m/%d/%y")
#  abline(v=df.events[i,sdate])
#  abline(v=df.events[i,edate])
#  axis.POSIXct(3,subdf$date,format = "%m/%d/%y",
#               at=c(df.events[i,sdate],df.events[i,edate]),
#               tcl=2)
plot(subQ~subdateQ,
#       data=subdf,
type="l",
xaxt="n",
ylab="Flow (cfs)",
xlab="",
col="red",
lwd=1,
yaxs="i",
log=logy,
ylim=c(Qmin,Qmax),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
logy
logy <- "y"
plot(subQ~subdateQ,
#       data=subdf,
type="l",
xaxt="n",
ylab="Flow (cfs)",
xlab="",
col="red",
lwd=1,
yaxs="i",
log=logy,
ylim=c(Qmin,Qmax),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
mylayout <- matrix(c(1,
1,
2,
2,
2),5,1,byrow=TRUE)
layout(mylayout)
p.sdate <- as.POSIXlt(df.events[i,sdate] - plot.buffer*24*3600/2,tz="")
p.edate <- as.POSIXlt(df.events[i,edate] + plot.buffer*24*3600/2,tz="")
subdf <- subset(df, df[,date]>=p.sdate & df[,date]<=p.edate)
rmax <- max(subdf[,rain] + 0.3)
subrain <- subdf[,rain]
subdate <- as.POSIXct(subdf[,date])
#Set Margins for first plot
par(mar= c(0, 4, 4, 2) + 0.1)
plot(subrain~subdate,
#       data=subdf,
type="h",
xaxt="n",
ylab="precipitation (mm)",
xlab="",
col="blue",
lwd=1,
yaxs="i",
ylim=c(rmax,0),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
mtext(main.title,side=3,line=2,cex=1.5)
mtext(paste("Event depth =",
round(df.events[i,rain],2),"mm"),
side=3,line=0.5,col=colors()[84])
arrows(df.events[i,sdate],(rmax-0.15),
df.events[i,edate],(rmax-0.15),
length=0.07,angle=20,col=colors()[84],
code=3)
########################## Graph Q  ################################################
subdfQ <- subset(dfQ, dfQ[,Qdate]>=p.sdate & dfQ[,Qdate]<=p.edate)
Qmax <- max(subdfQ[,Q] *1.05)
if(Qmax < 0) Qmax <- Qmax*0.95
if(Qmax > 0) Qmax <- Qmax*1.05
Qmin <- min(c(subdfQ[,Q]))
if(Qmin <= 0) Qmin <- Qmin*1.05; logy <- ""
if(Qmin > 0) Qmin <- Qmin*0.95; logy <- logy
subQ <- subdfQ[,Q]
subdateQ <- as.POSIXct(subdfQ[,date])
#Set Margins for second plot
par(mar= c(5, 4, 0, 2) + 0.1)
plot(subQ~subdateQ,
#       data=subdf,
type="l",
xaxt="n",
ylab="Flow (cfs)",
xlab="",
col="red",
lwd=1,
yaxs="i",
log=logy,
ylim=c(Qmin,Qmax),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
r <- as.POSIXct(trunc(range(subdf[,date]), "days"))
r[2] <- r[2]+24*3600
rhour <- seq(r[1], r[2], by=24*3600/4)
rday <- seq(r[1], r[2], by="days")
axis.POSIXct(1,subdf[,date],at=rhour,format=" ",tcl=-0.2)
axis.POSIXct(1,subdf[,date],at=rday,format=" ",tcl=-0.5)
axis.POSIXct(3,subdf[,date],at=rhour,format=" ",tcl=0.2)
axis.POSIXct(3,subdf[,date],at=rday,format=" ",tcl=0.5)
axis.POSIXct(1,subdf[,date],format = "%m/%d/%y")
#  abline(v=df.events[i,sdate])
#  abline(v=df.events[i,edate])
#  axis.POSIXct(3,subdf$date,format = "%m/%d/%y",
#               at=c(df.events[i,sdate],df.events[i,edate]),
#               tcl=2)
getwd()
source('D:/srcldata/R/Rainmaker/fxn_RMevents.plotQ.R')
setwd(paste(Rlocal,"/MMSD_virus/Virus2/Rain",sep=""))
pdf(paste(site.name,"_events.pdf",sep=""))
# Define plot layout: panel 1 for Q and panel 2 for FIB
mylayout <- matrix(c(1,
1,
2,
2,
2),5,1,byrow=TRUE)
layout(mylayout)
main.title <- paste(site.name,"Precipitation and Q Event")
for (i in 1:(nrow(df.events))) {
########################## Graph Precip  ###########################################
p.sdate <- as.POSIXlt(df.events[i,sdate] - plot.buffer*24*3600/2,tz="")
p.edate <- as.POSIXlt(df.events[i,edate] + plot.buffer*24*3600/2,tz="")
subdf <- subset(df, df[,date]>=p.sdate & df[,date]<=p.edate)
rmax <- max(subdf[,rain] + 0.3)
subrain <- subdf[,rain]
subdate <- as.POSIXct(subdf[,date])
#Set Margins for first plot
par(mar= c(0, 4, 4, 2) + 0.1)
plot(subrain~subdate,
#       data=subdf,
type="h",
xaxt="n",
ylab="precipitation (mm)",
xlab="",
col="blue",
lwd=1,
yaxs="i",
ylim=c(rmax,0),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
mtext(main.title,side=3,line=2,cex=1.5)
mtext(paste("Event depth =",
round(df.events[i,rain],2),"mm"),
side=3,line=0.5,col=colors()[84])
arrows(df.events[i,sdate],(rmax-0.15),
df.events[i,edate],(rmax-0.15),
length=0.07,angle=20,col=colors()[84],
code=3)
########################## Graph Q  ################################################
subdfQ <- subset(dfQ, dfQ[,Qdate]>=p.sdate & dfQ[,Qdate]<=p.edate)
Qmax <- max(subdfQ[,Q] *1.05)
if(Qmax < 0) Qmax <- Qmax*0.95
if(Qmax > 0) Qmax <- Qmax*1.05
Qmin <- min(c(subdfQ[,Q]))
if(Qmin <= 0) Qmin <- Qmin*1.05; logy <- ""
if(Qmin > 0) Qmin <- Qmin*0.95; logy <- logy
subQ <- subdfQ[,Q]
subdateQ <- as.POSIXct(subdfQ[,date])
#Set Margins for second plot
par(mar= c(5, 4, 0, 2) + 0.1)
plot(subQ~subdateQ,
#       data=subdf,
type="l",
xaxt="n",
ylab="Flow (cfs)",
xlab="",
col="red",
lwd=1,
yaxs="i",
log=logy,
ylim=c(Qmin,Qmax),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
r <- as.POSIXct(trunc(range(subdf[,date]), "days"))
r[2] <- r[2]+24*3600
rhour <- seq(r[1], r[2], by=24*3600/4)
rday <- seq(r[1], r[2], by="days")
axis.POSIXct(1,subdf[,date],at=rhour,format=" ",tcl=-0.2)
axis.POSIXct(1,subdf[,date],at=rday,format=" ",tcl=-0.5)
axis.POSIXct(3,subdf[,date],at=rhour,format=" ",tcl=0.2)
axis.POSIXct(3,subdf[,date],at=rday,format=" ",tcl=0.5)
axis.POSIXct(1,subdf[,date],format = "%m/%d/%y")
#  abline(v=df.events[i,sdate])
#  abline(v=df.events[i,edate])
#  axis.POSIXct(3,subdf$date,format = "%m/%d/%y",
#               at=c(df.events[i,sdate],df.events[i,edate]),
#               tcl=2)
}
par(mar=c(5,2,0,1))
dev.off()
source('D:/srcldata/R/Rainmaker/fxn_RMevents.plotQ.R')
i
i <-1
# Define plot layout: panel 1 for Q and panel 2 for FIB
mylayout <- matrix(c(1,
1,
2,
2,
2),5,1,byrow=TRUE)
layout(mylayout)
########################## Graph Precip  ###########################################
p.sdate <- as.POSIXlt(df.events[i,sdate] - plot.buffer*24*3600/2,tz="")
p.edate <- as.POSIXlt(df.events[i,edate] + plot.buffer*24*3600/2,tz="")
subdf <- subset(df, df[,date]>=p.sdate & df[,date]<=p.edate)
rmax <- max(subdf[,rain] + 0.3)
subrain <- subdf[,rain]
subdate <- as.POSIXct(subdf[,date])
#Set Margins for first plot
par(mar= c(0, 4, 4, 2) + 0.1)
plot(subrain~subdate,
#       data=subdf,
type="h",
xaxt="n",
ylab="precipitation (mm)",
xlab="",
col="blue",
lwd=1,
yaxs="i",
ylim=c(rmax,0),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
mtext(main.title,side=3,line=2,cex=1.5)
mtext(paste("Event depth =",
round(df.events[i,rain],2),"mm"),
side=3,line=0.5,col=colors()[84])
arrows(df.events[i,sdate],(rmax-0.15),
df.events[i,edate],(rmax-0.15),
length=0.07,angle=20,col=colors()[84],
code=3)
########################## Graph Q  ################################################
subdfQ <- subset(dfQ, dfQ[,Qdate]>=p.sdate & dfQ[,Qdate]<=p.edate)
Qmax <- max(subdfQ[,Q] *1.05)
if(Qmax < 0) Qmax <- Qmax*0.95
if(Qmax > 0) Qmax <- Qmax*1.05
Qmin <- min(c(subdfQ[,Q]))
if(Qmin <= 0) Qmin <- Qmin*1.05; logy <- ""
if(Qmin > 0) Qmin <- Qmin*0.95; logy <- logy
subQ <- subdfQ[,Q]
subdateQ <- as.POSIXct(subdfQ[,date])
#Set Margins for second plot
par(mar= c(5, 4, 0, 2) + 0.1)
plot(subQ~subdateQ,
#       data=subdf,
type="l",
xaxt="n",
ylab="Flow (cfs)",
xlab="",
col="red",
lwd=1,
yaxs="i",
log=logy,
ylim=c(Qmin,Qmax),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
r <- as.POSIXct(trunc(range(subdf[,date]), "days"))
r[2] <- r[2]+24*3600
rhour <- seq(r[1], r[2], by=24*3600/4)
rday <- seq(r[1], r[2], by="days")
axis.POSIXct(1,subdf[,date],at=rhour,format=" ",tcl=-0.2)
axis.POSIXct(1,subdf[,date],at=rday,format=" ",tcl=-0.5)
axis.POSIXct(3,subdf[,date],at=rhour,format=" ",tcl=0.2)
axis.POSIXct(3,subdf[,date],at=rday,format=" ",tcl=0.5)
axis.POSIXct(1,subdf[,date],format = "%m/%d/%y")
#  abline(v=df.events[i,sdate])
#  abline(v=df.events[i,edate])
#  axis.POSIXct(3,subdf$date,format = "%m/%d/%y",
#               at=c(df.events[i,sdate],df.events[i,edate]),
#               tcl=2)
as.POSIXct(range(subdf[,date]))
head(subdfQ)
tail(subdfQ,2)
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="",isdst=1)
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="")
str(dfRain)
dfRain <- dfRain[which(!is.na(dfRain$pdate)),]
dfRain$pdate <- as.POSIXlt(dfRain$pdate,isdst=1)
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="")
dfRain$pdate2 <- as.POSIXlt(dfRain$pdate,isdst=1)
sum(dfRain$pdate != dfRain$pdate2)
str(dfRain)
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="") - GMToffset*60*60
GMToffset <- 5 # hours to central standard time
dfRain$pdate <- strptime(dfRain$GMT.Time,format="%m/%d/%Y %H:%M",tz="") - GMToffset*60*60
str(dfRain)
pdf(paste(site.name,"_events.pdf",sep=""))
# Define plot layout: panel 1 for Q and panel 2 for FIB
mylayout <- matrix(c(1,
1,
2,
2,
2),5,1,byrow=TRUE)
layout(mylayout)
main.title <- paste(site.name,"Precipitation and Q Event")
for (i in 1:(nrow(df.events))) {
########################## Graph Precip  ###########################################
p.sdate <- as.POSIXlt(df.events[i,sdate] - plot.buffer*24*3600/2,tz="")
p.edate <- as.POSIXlt(df.events[i,edate] + plot.buffer*24*3600/2,tz="")
subdf <- subset(df, df[,date]>=p.sdate & df[,date]<=p.edate)
rmax <- max(subdf[,rain] + 0.3)
subrain <- subdf[,rain]
subdate <- as.POSIXct(subdf[,date])
#Set Margins for first plot
par(mar= c(0, 4, 4, 2) + 0.1)
plot(subrain~subdate,
#       data=subdf,
type="h",
xaxt="n",
ylab="precipitation (mm)",
xlab="",
col="blue",
lwd=1,
yaxs="i",
ylim=c(rmax,0),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
mtext(main.title,side=3,line=2,cex=1.5)
mtext(paste("Event depth =",
round(df.events[i,rain],2),"mm"),
side=3,line=0.5,col=colors()[84])
arrows(df.events[i,sdate],(rmax-0.15),
df.events[i,edate],(rmax-0.15),
length=0.07,angle=20,col=colors()[84],
code=3)
########################## Graph Q  ################################################
subdfQ <- subset(dfQ, dfQ[,Qdate]>=p.sdate & dfQ[,Qdate]<=p.edate)
Qmax <- max(subdfQ[,Q] *1.05)
if(Qmax < 0) Qmax <- Qmax*0.95
if(Qmax > 0) Qmax <- Qmax*1.05
Qmin <- min(c(subdfQ[,Q]))
if(Qmin <= 0) Qmin <- Qmin*1.05; logy <- ""
if(Qmin > 0) Qmin <- Qmin*0.95; logy <- logy
subQ <- subdfQ[,Q]
subdateQ <- as.POSIXct(subdfQ[,date])
#Set Margins for second plot
par(mar= c(5, 4, 0, 2) + 0.1)
plot(subQ~subdateQ,
#       data=subdf,
type="l",
xaxt="n",
ylab="Flow (cfs)",
xlab="",
col="red",
lwd=1,
yaxs="i",
log=logy,
ylim=c(Qmin,Qmax),
xlim=as.POSIXct(range(subdf[,date])),
main = "")
r <- as.POSIXct(trunc(range(subdf[,date]), "days"))
r[2] <- r[2]+24*3600
rhour <- seq(r[1], r[2], by=24*3600/4)
rday <- seq(r[1], r[2], by="days")
axis.POSIXct(1,subdf[,date],at=rhour,format=" ",tcl=-0.2)
axis.POSIXct(1,subdf[,date],at=rday,format=" ",tcl=-0.5)
axis.POSIXct(3,subdf[,date],at=rhour,format=" ",tcl=0.2)
axis.POSIXct(3,subdf[,date],at=rday,format=" ",tcl=0.5)
axis.POSIXct(1,subdf[,date],format = "%m/%d/%y")
#  abline(v=df.events[i,sdate])
#  abline(v=df.events[i,edate])
#  axis.POSIXct(3,subdf$date,format = "%m/%d/%y",
#               at=c(df.events[i,sdate],df.events[i,edate]),
#               tcl=2)
}
par(mar=c(5,2,0,1))
dev.off()
save.image("D:/srcldata/R/MMSD_virus/Virus2/Rain/MenomRainAnalysis.RData")
>>>>>>> a11164bd54cf25e5e68a61d5c81bca21d8dea072
